{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://liquid-labs.com/schemas/components/v1/component.schema.json",
  "title": "Component Definition",
  "description": "Schema for all Component types",
  "type": "object",
  "required": ["apiVersion", "kind", "metadata", "contracts", "dependencies", "configuration"],
  "additionalProperties": false,
  "properties": {
    "apiVersion": {
      "type": "string",
      "const": "components.liquid-labs.com/v1",
      "description": "API version for Component definitions"
    },
    "kind": {
      "type": "string",
      "enum": ["ServiceComponent", "InfrastructureComponent", "InterfaceComponent", "IntegrationComponent"],
      "description": "Component type"
    },
    "metadata": {
      "type": "object",
      "required": ["name", "module", "moduleRegistry", "repository", "version", "description", "status", "languages"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "$ref": "../shared-definitions.schema.json#/$defs/identifier"
        },
        "module": {
          "$ref": "../shared-definitions.schema.json#/$defs/identifier"
        },
        "moduleRegistry": {
          "$ref": "../shared-definitions.schema.json#/$defs/repositoryUrl"
        },
        "repository": {
          "$ref": "../shared-definitions.schema.json#/$defs/repositoryUrl"
        },
        "version": {
          "$ref": "../shared-definitions.schema.json#/$defs/semver"
        },
        "description": {
          "$ref": "../shared-definitions.schema.json#/$defs/description"
        },
        "status": {
          "$ref": "../shared-definitions.schema.json#/$defs/status"
        },
        "languages": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "../shared-definitions.schema.json#/$defs/languageWithVersion"
          }
        }
      }
    },
    "contracts": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/componentContract"
      },
      "description": "Contracts this Component provides"
    },
    "dependencies": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/componentDependency"
      },
      "description": "Dependencies on other Modules"
    },
    "configuration": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "required": {
          "type": "array",
          "items": {
            "$ref": "../shared-definitions.schema.json#/$defs/environmentVariable"
          }
        },
        "optional": {
          "type": "array",
          "items": {
            "$ref": "../shared-definitions.schema.json#/$defs/environmentVariable"
          }
        }
      },
      "description": "Configuration requirements"
    }
  },
  "$defs": {
    "componentContract": {
      "type": "object",
      "required": ["name", "type", "version"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "$ref": "../shared-definitions.schema.json#/$defs/identifier"
        },
        "type": {
          "$ref": "../shared-definitions.schema.json#/$defs/contractType"
        },
        "version": {
          "$ref": "../shared-definitions.schema.json#/$defs/contractVersion"
        },
        "spec": {
          "type": "string",
          "description": "Path to specification file or directory"
        },
        "description": {
          "$ref": "../shared-definitions.schema.json#/$defs/longDescription"
        },
        "status": {
          "$ref": "../shared-definitions.schema.json#/$defs/statusWithDeprecated"
        }
      }
    },
    "componentDependency": {
      "type": "object",
      "required": ["module", "contract"],
      "additionalProperties": false,
      "properties": {
        "module": {
          "$ref": "../shared-definitions.schema.json#/$defs/identifier"
        },
        "component": {
          "$ref": "../shared-definitions.schema.json#/$defs/identifier"
        },
        "version": {
          "type": "string",
          "description": "Semantic version range for the Module"
        },
        "contract": {
          "$ref": "../shared-definitions.schema.json#/$defs/identifier"
        },
        "optional": {
          "type": "boolean",
          "default": false,
          "description": "Whether this dependency is optional"
        }
      }
    }
  }
}
